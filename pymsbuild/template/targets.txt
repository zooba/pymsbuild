  <Target Name="BuildDependencies">
    <MSBuild
        Projects="@(Project)"
        Targets="Build"
        Properties="OutDir=$(OutDir)%(Destination)\;IntDir=$(IntDir)..\%(Name)\">
      <Output TaskParameter="TargetOutputs" ItemName="_Outputs" />
    </MSBuild>
  </Target>

  <Target Name="CleanDependencies">
    <MSBuild
        Projects="@(Project)"
        Targets="Clean"
        Properties="OutDir=$(OutDir)%(Destination)\;IntDir=$(IntDir)..\%(Name)\" />
  </Target>

  <Target Name="AssignDestinationPath">
    <ItemGroup>
      <Content>
        <DestinationPath>$(OutDir)%(Destination)\%(Filename)%(Extension)</DestinationPath>
      </Content>
    </ItemGroup>
  </Target>

  <Target Name="CopyContent" Inputs="@(Content)" Outputs="%(Content.DestinationPath)">
    <Message Text="%(Content.FullPath) --> %(Content.DestinationPath)" Importance="high"
             Condition="%(Content.FullPath) != %(Content.DestinationPath)" />
  </Target>

  <Target Name="GetTargetPath" Outputs="@(Content)" />

  <Target Name="Build" DependsOnTargets="BuildDependencies;AssignDestinationPath;CopyContent">
  </Target>

  <Target Name="Clean" DependsOnTargets="CleanDependencies;AssignDestinationPath">
    <MSBuild Projects="@(Project)" Targets="Clean" />
    <Message Text="Delete %(Content.DestinationPath)" Importance="high"
             Condition="%(Content.FullPath) != %(Content.DestinationPath)" />
  </Target>

  <Target Name="Rebuild" DependsOnTargets="Clean;Build" />
